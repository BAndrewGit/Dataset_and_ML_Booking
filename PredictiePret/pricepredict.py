# -*- coding: utf-8 -*-
"""PricePredict.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1SgcUwDofaKrzP_0wbT9NQvPWqhH0CuHv
"""

import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn import metrics
from sklearn.impute import SimpleImputer


df = pd.read_csv('clean_dataset.csv')


df = pd.get_dummies(df, columns=['type'])


caracteristici = df[['Frigider',
    'Cadă sau duş',
    'terasă',
    'Factură disponibilă la cerere',
    'Uscător de păr',
    'Duş',
    'Pardoseală de lemn sau parchet']]
tinta = df['price']


imputer = SimpleImputer(strategy='mean')


caracteristici_antrenament, caracteristici_testare, tinta_antrenament, tinta_testare = train_test_split(caracteristici, tinta, test_size=0.2, random_state=0)


caracteristici_antrenament_imputate = imputer.fit_transform(caracteristici_antrenament)
caracteristici_testare_imputate = imputer.transform(caracteristici_testare)
tinta_antrenament_imputata = imputer.fit_transform(tinta_antrenament.values.reshape(-1,1))


model = LinearRegression()
model.fit(caracteristici_antrenament_imputate, tinta_antrenament_imputata)


tinta_predusa = model.predict(caracteristici_testare_imputate)


print('Eroare absolută medie:', metrics.mean_absolute_error(tinta_testare, tinta_predusa))
print('Eroare pătratică medie:', metrics.mean_squared_error(tinta_testare, tinta_predusa))
print('Rădăcina erorii pătratice medii:', np.sqrt(metrics.mean_squared_error(tinta_testare, tinta_predusa)))

from sklearn.tree import DecisionTreeRegressor
from sklearn.tree import DecisionTreeClassifier



model_arbore = DecisionTreeRegressor(random_state=0)


model_arbore.fit(caracteristici_antrenament_imputate, tinta_antrenament_imputata)


importanta_caracteristicilor = model_arbore.feature_importances_



df_importanta = pd.DataFrame({
    'Facilitate': caracteristici.columns,
    'Importanta': importanta_caracteristicilor
})


df_importanta = df_importanta.sort_values(by='Importanta', ascending=False)


print(df_importanta)


tinta_predusa_arbore = model_arbore.predict(caracteristici_testare_imputate)


print('Eroare absolută medie:', metrics.mean_absolute_error(tinta_testare, tinta_predusa_arbore))
print('Eroare pătratică medie:', metrics.mean_squared_error(tinta_testare, tinta_predusa_arbore))
print('Rădăcina erorii pătratice medii:', np.sqrt(metrics.mean_squared_error(tinta_testare, tinta_predusa_arbore)))


df_nou = pd.read_csv('Dataset_Vaslui.csv')


caracteristici_noi = df_nou[['Frigider', 'Cadă sau duş', 'terasă', 'Factură disponibilă la cerere', 'Uscător de păr', 'Duş', 'Pardoseală de lemn sau parchet']]


imputer_caracteristici = SimpleImputer(strategy='mean')


imputer_caracteristici.fit(caracteristici_antrenament)


caracteristici_noi_imputate = imputer_caracteristici.transform(caracteristici_noi)


preturi_prezise_arbore = model_arbore.predict(caracteristici_noi_imputate)
preturi_prezise_liniar = model.predict(caracteristici_noi_imputate)


for cazare, pret_arbore, pret_liniar in zip(df_nou['name'], preturi_prezise_arbore, preturi_prezise_liniar):
    print(f"Cazarea {cazare} are un preț prezis de {pret_arbore} (model arbore) și {pret_liniar} (model liniar)")

import matplotlib.pyplot as plt
import seaborn as sns


plt.figure(figsize=(8,6))
sns.histplot(df['price'], kde=True)
plt.title('Distribuția prețurilor')
plt.show()


correlation_matrix=df.corr(numeric_only=True)
plt.figure(figsize=(10,8))
sns.heatmap(correlation_matrix, annot=False, cmap='coolwarm', linewidths=0.5)
plt.title('Matricea de corelație')
plt.show()


plt.figure(figsize=(10,8))
sns.barplot(x='Importanta', y='Facilitate', data=df_importanta)
plt.title('Importanța caracteristicilor')
plt.show()


plt.figure(figsize=(8,6))
sns.residplot(x=tinta_testare, y=tinta_predusa.flatten(), lowess=True)
plt.title('Plotul reziduurilor pentru modelul de regresie liniară')
plt.xlabel('Valoarea actuală')
plt.ylabel('Reziduuri')
plt.show()


plt.figure(figsize=(8,6))
sns.residplot(x=tinta_testare, y=tinta_predusa_arbore.flatten(), lowess=True)
plt.title('Plotul reziduurilor pentru modelul de arbore de decizie')
plt.xlabel('Valoarea actuală')
plt.ylabel('Reziduuri')
plt.show()


plt.figure(figsize=(8,6))
plt.scatter(tinta_testare, tinta_predusa)
plt.title('Plotul erorii de predicție pentru modelul de regresie liniară')
plt.xlabel('Valoarea actuală')
plt.ylabel('Valoarea prezisă')
plt.show()


plt.figure(figsize=(8,6))
plt.scatter(tinta_testare, tinta_predusa_arbore)
plt.title('Plotul erorii de predicție pentru modelul de arbore de decizie')
plt.xlabel('Valoarea actuală')
plt.ylabel('Valoarea prezisă')
plt.show()